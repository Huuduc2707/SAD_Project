(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("mobx-state-tree"),require("reactotron-core-client"),require("ramda")):"function"==typeof define&&define.amd?define(["exports","mobx-state-tree","reactotron-core-client","ramda"],b):(a=a||self,b(a.reactotronMst={},a.mobxStateTree,a.reactotronCoreClient,a.ramda))})(this,function(a,b,c,d){"use strict";function e(a){"@babel/helpers - typeof";return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e(a)}var f=function(a,b){return d.path(d.split(".",a),b)},g=function(a){return d.isNil(a)||d.isEmpty(a)},h=function(a){return"undefined"!=typeof a&&null!==a&&d.has("nativeEvent",a)&&d.has("target",a)&&d.has("type",a)},i=function(a){var b=Array.isArray(a)?a:[a];return b.map(function(a){return h(a)?"ReactNativeEvent":a})},j=function(a){return"object"===e(a)&&"name"in a&&"string"==typeof a.name&&(!("path"in a)||"string"==typeof a.path)&&(!("args"in a)||Array.isArray(a.args))},k=function(a){return Array.isArray(a)&&a.every(j)};a.mst=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return function(e){function h(a,c){b.onSnapshot(a,r),b.addMiddleware(a,function(f,g){var h="action"!==f.type;if(h)return g(f);var j=w(f);if(!j)return g(f);var k=i(f.args),l=b.getPath(f.context),m={args:k,name:f.name,path:l},n={id:f.id,parentId:f.parentId,rootId:f.rootId,type:f.type,modelType:b.getType(a),alive:b.isAlive(a),root:b.isRoot(a),protected:b.isProtected(a)},o=e.startTimer(),p=g(f),q=o(),r=d.replace(/^\./,"",d.replace(/\//g,".",l)),s=d.replace(/^\./,"","".concat(null!==c&&void 0!==c?c:"").concat(r,".").concat(f.name,"()"));return s=d.replace("/",".",s),u||e.send("state.action.complete",{name:s,action:m,mst:n,ms:q}),p})}function l(a){var c=t["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"];if(c&&c.node){var d=b.getSnapshot(c.node);e.send("state.backup.response",{state:d})}}function m(a){var c=t["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"],d=a&&a.payload&&a.payload.state;if(c&&c.node){var e=c.node;u=!0,b.applySnapshot(e,d),u=!1}}function n(a){var c=t["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"],d=a&&a.payload&&a.payload.action,e=j(d)||k(d);if(c&&c.node&&d&&e){var f=c.node;try{b.applyAction(f,d)}catch(a){}}}function o(c){var e=t["mstNodeName"in c&&"string"==typeof c.mstNodeName?c.mstNodeName:"default"],f=c&&c.payload&&c.payload.paths||[];if(f&&(v=d.uniq(d.flatten(f))),e&&e.node){var g="snapshot"===a.queryMode?b.getSnapshot(e.node):e.node;r(g)}}function p(a){var c,e=t["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"],h=null===a||void 0===a||null===(c=a.payload)||void 0===c?void 0:c.path;if(e&&e.node){var i=b.getSnapshot(e.node);if(g(h))s.stateKeysResponse(null,d.keys(i));else{var j=d.keys(f(h,i));s.stateKeysResponse(h,j)}}}function q(a){var c,d=t["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"],e=null===a||void 0===a||null===(c=a.payload)||void 0===c?void 0:c.path;if(d&&d.node){var h=b.getSnapshot(d.node);g(e)?s.stateValuesResponse(null,h):s.stateValuesResponse(e,f(e,h))}}function r(a){var b=d.pipe(d.map(d.when(d.isNil,d.always(""))),d.filter(d.endsWith(".*")),d.map(function(b){var c=d.slice(0,-2,b),e=f(c,a);return d.is(Object,e)&&!g(e)?d.pipe(d.keys,d.map(function(a){return"".concat(c,".").concat(a)}))(e||{}):[]}),d.concat(d.map(d.when(d.isNil,d.always("")),v)),d.flatten,d.reject(d.endsWith(".*")),d.uniq,d.sortBy(d.identity),d.map(function(b){return{path:b,value:g(b)?a:f(b,a)}}))(v);s.stateValuesChange(b)}c.assertHasStateResponsePlugin(e);var s=e,t={},u=!1,v=[],w=a.filter?a.filter:function(){return!0},x={"state.backup.request":l,"state.restore.request":m,"state.action.dispatch":n,"state.values.subscribe":o,"state.keys.request":p,"state.values.request":q};return{onCommand:function(a){var b=x[a&&a.type];b&&b(a)},features:{trackMstNode:function(a){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"default";if(!a)return{kind:"required"};if(t[c])return{kind:"already-tracking"};try{var d=b.getType(a);if(d.isType)try{return h(a),t[c]={node:a,modelType:d},{kind:"ok"}}catch(a){return{kind:"tracking-error",message:a instanceof Error?a.message:"Unknown error - tracking error did not have message"}}else return{kind:"invalid-node"}}catch(a){return{kind:"invalid-node"}}}}}}},Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=reactotron-mst.umd.js.map

import{getType,onSnapshot,addMiddleware,getPath,isAlive,isRoot,isProtected,getSnapshot,applySnapshot,applyAction}from"mobx-state-tree";import{assertHasStateResponsePlugin}from"reactotron-core-client";import{has,replace,pipe,map,when,isNil,always,filter,endsWith,slice,path,split,is,isEmpty,keys,concat,flatten,reject,uniq,sortBy,identity}from"ramda";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}var dotPath=function(a,b){return path(split(".",a),b)},isNilOrEmpty=function(a){return isNil(a)||isEmpty(a)},isReactNativeEvent=function(a){return"undefined"!=typeof a&&null!==a&&has("nativeEvent",a)&&has("target",a)&&has("type",a)},convertUnsafeArguments=function(a){var b=Array.isArray(a)?a:[a];return b.map(function(a){return isReactNativeEvent(a)?"ReactNativeEvent":a})},isSerializedActionCall=function(a){return"object"===_typeof(a)&&"name"in a&&"string"==typeof a.name&&(!("path"in a)||"string"==typeof a.path)&&(!("args"in a)||Array.isArray(a.args))},isSerializedActionCallArray=function(a){return Array.isArray(a)&&a.every(isSerializedActionCall)};function mst(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return function(b){function c(a,c){onSnapshot(a,j),addMiddleware(a,function(d,e){var f="action"!==d.type;if(f)return e(d);var g=o(d);if(!g)return e(d);var h=convertUnsafeArguments(d.args),i=getPath(d.context),j={args:h,name:d.name,path:i},k={id:d.id,parentId:d.parentId,rootId:d.rootId,type:d.type,modelType:getType(a),alive:isAlive(a),root:isRoot(a),protected:isProtected(a)},l=b.startTimer(),n=e(d),p=l(),q=replace(/^\./,"",replace(/\//g,".",i)),r=replace(/^\./,"","".concat(null!==c&&void 0!==c?c:"").concat(q,".").concat(d.name,"()"));return r=replace("/",".",r),m||b.send("state.action.complete",{name:r,action:j,mst:k,ms:p}),n})}function d(a){var c=l["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"];if(c&&c.node){var d=getSnapshot(c.node);b.send("state.backup.response",{state:d})}}function e(a){var b=l["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"],c=a&&a.payload&&a.payload.state;if(b&&b.node){var d=b.node;m=!0,applySnapshot(d,c),m=!1}}function f(a){var b=l["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"],c=a&&a.payload&&a.payload.action,d=isSerializedActionCall(c)||isSerializedActionCallArray(c);if(b&&b.node&&c&&d){var e=b.node;try{applyAction(e,c)}catch(a){}}}function g(b){var c=l["mstNodeName"in b&&"string"==typeof b.mstNodeName?b.mstNodeName:"default"],d=b&&b.payload&&b.payload.paths||[];if(d&&(n=uniq(flatten(d))),c&&c.node){var e="snapshot"===a.queryMode?getSnapshot(c.node):c.node;j(e)}}function h(a){var b,c=l["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"],d=null===a||void 0===a||null===(b=a.payload)||void 0===b?void 0:b.path;if(c&&c.node){var e=getSnapshot(c.node);if(isNilOrEmpty(d))k.stateKeysResponse(null,keys(e));else{var f=keys(dotPath(d,e));k.stateKeysResponse(d,f)}}}function i(a){var b,c=l["mstNodeName"in a&&"string"==typeof a.mstNodeName?a.mstNodeName:"default"],d=null===a||void 0===a||null===(b=a.payload)||void 0===b?void 0:b.path;if(c&&c.node){var e=getSnapshot(c.node);isNilOrEmpty(d)?k.stateValuesResponse(null,e):k.stateValuesResponse(d,dotPath(d,e))}}function j(a){var b=pipe(map(when(isNil,always(""))),filter(endsWith(".*")),map(function(b){var c=slice(0,-2,b),d=dotPath(c,a);return is(Object,d)&&!isNilOrEmpty(d)?pipe(keys,map(function(a){return"".concat(c,".").concat(a)}))(d||{}):[]}),concat(map(when(isNil,always("")),n)),flatten,reject(endsWith(".*")),uniq,sortBy(identity),map(function(b){return{path:b,value:isNilOrEmpty(b)?a:dotPath(b,a)}}))(n);k.stateValuesChange(b)}assertHasStateResponsePlugin(b);var k=b,l={},m=!1,n=[],o=a.filter?a.filter:function(){return!0},p={"state.backup.request":d,"state.restore.request":e,"state.action.dispatch":f,"state.values.subscribe":g,"state.keys.request":h,"state.values.request":i};return{onCommand:function(a){var b=p[a&&a.type];b&&b(a)},features:{trackMstNode:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"default";if(!a)return{kind:"required"};if(l[b])return{kind:"already-tracking"};try{var d=getType(a);if(d.isType)try{return c(a),l[b]={node:a,modelType:d},{kind:"ok"}}catch(a){return{kind:"tracking-error",message:a instanceof Error?a.message:"Unknown error - tracking error did not have message"}}else return{kind:"invalid-node"}}catch(a){return{kind:"invalid-node"}}}}}}}export{mst};
//# sourceMappingURL=reactotron-mst.es5.js.map
